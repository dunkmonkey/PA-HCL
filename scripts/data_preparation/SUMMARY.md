# PA-HCL æ•°æ®å‡†å¤‡å·¥å…· - å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

æœ¬æ¬¡ä»»åŠ¡å·²ç»å®Œæˆäº† PA-HCL é¡¹ç›®çš„å®Œæ•´æ•°æ®å‡†å¤‡å·¥å…·é“¾ï¼ŒåŒ…æ‹¬ï¼š

### 1. å…¬å¼€æ•°æ®é›†å‡†å¤‡è„šæœ¬

#### âœ“ CirCor DigiScope Dataset (`prepare_circor.py`)
- **åŠŸèƒ½**ï¼šå°† CirCor æ•°æ®é›†è½¬æ¢ä¸ºå—è¯•è€…ç»„ç»‡æ ¼å¼
- **ç‰¹ç‚¹**ï¼š
  - è‡ªåŠ¨æ£€æµ‹å’ŒéªŒè¯è¾“å…¥ç›®å½•ç»“æ„
  - æ”¯æŒå¤šä½ç½®å¬è¯Šè®°å½•ï¼ˆAV, MV, PV, TVï¼‰
  - ä¿ç•™å…ƒæ•°æ®ä¿¡æ¯
  - æ”¯æŒç¬¦å·é“¾æ¥ï¼ˆèŠ‚çœç©ºé—´ï¼‰æˆ–æ–‡ä»¶å¤åˆ¶

#### âœ“ PhysioNet 2016 Challenge Dataset (`prepare_physionet2016.py`)
- **åŠŸèƒ½**ï¼šå‡†å¤‡ PhysioNet 2016 æŒ‘æˆ˜èµ›æ•°æ®é›†
- **ç‰¹ç‚¹**ï¼š
  - æ”¯æŒè®­ç»ƒé›†å’ŒéªŒè¯é›†
  - è‡ªåŠ¨å¤„ç†ä¸åŒçš„ç›®å½•ç»“æ„å˜ä½“
  - ä¿ç•™æ ‡ç­¾ä¿¡æ¯ï¼ˆREFERENCE.csvï¼‰

#### âœ“ Pascal Challenge Dataset (`prepare_pascal.py`)
- **åŠŸèƒ½**ï¼šå‡†å¤‡ Pascal æŒ‘æˆ˜èµ›æ•°æ®é›†
- **ç‰¹ç‚¹**ï¼š
  - æ”¯æŒå¤šä¸ªå­é›†ï¼ˆset_a, set_bï¼‰
  - çµæ´»å¤„ç†ä¸åŒçš„å‘½åè§„åˆ™
  - å¯é€‰æ ‡ç­¾æ–‡ä»¶æ”¯æŒ

### 2. è‡ªå»ºæ•°æ®é›†å‡†å¤‡è„šæœ¬

#### âœ“ Custom Dataset (`prepare_custom.py`)
- **åŠŸèƒ½**ï¼šå¤„ç†æŒ‰ç–¾ç—…ç±»åˆ«ç»„ç»‡çš„è‡ªå»ºæ•°æ®é›†
- **ç‰¹ç‚¹**ï¼š
  - æ™ºèƒ½æ–‡ä»¶åè§£æ
  - è‡ªåŠ¨æå–å…ƒæ•°æ®ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€ä½ç½®ç­‰ï¼‰
  - æ”¯æŒå¯é€‰çš„ Excel/CSV å…ƒæ•°æ®æ–‡ä»¶
  - ç”Ÿæˆå®Œæ•´çš„å…ƒæ•°æ®è®°å½•

**æ”¯æŒçš„æ–‡ä»¶å‘½åæ ¼å¼**ï¼š
```
<condition>_case<id>_<gender>_<age>_<duration>_<country>_<location>.wav
ç¤ºä¾‹: asd_case0001_female_4_20s_USA_A.wav
```

### 3. è¾…åŠ©å·¥å…·

#### âœ“ æ•°æ®é›†ä¸‹è½½è„šæœ¬ (`download_datasets.py`)
- **åŠŸèƒ½**ï¼šè‡ªåŠ¨ä¸‹è½½å…¬å¼€æ•°æ®é›†
- **ç‰¹ç‚¹**ï¼š
  - æ”¯æŒæ–­ç‚¹ç»­ä¼ 
  - è¿›åº¦æ¡æ˜¾ç¤º
  - è‡ªåŠ¨è§£å‹ç¼©
  - MD5 æ ¡éªŒï¼ˆå¯é€‰ï¼‰
  - æ”¯æŒ CirCor å’Œ PhysioNet 2016

#### âœ“ ç»Ÿä¸€å…¥å£è„šæœ¬ (`prepare_data.py`)
- **åŠŸèƒ½**ï¼šè‡ªåŠ¨æ£€æµ‹æ•°æ®é›†ç±»å‹å¹¶è°ƒç”¨å¯¹åº”çš„å‡†å¤‡è„šæœ¬
- **ç‰¹ç‚¹**ï¼š
  - æ™ºèƒ½æ•°æ®é›†ç±»å‹è¯†åˆ«
  - ç»Ÿä¸€çš„å‘½ä»¤è¡Œæ¥å£
  - æ‰¹é‡å¤„ç†å¤šä¸ªæ•°æ®é›†

#### âœ“ å¿«é€Ÿå¯åŠ¨è„šæœ¬ (`quickstart.sh`)
- **åŠŸèƒ½**ï¼šä¸€é”®å¼å·¥ä½œæµ
- **ç‰¹ç‚¹**ï¼š
  - ç¯å¢ƒæ£€æŸ¥
  - å®Œæ•´æµç¨‹è‡ªåŠ¨åŒ–ï¼ˆä¸‹è½½â†’å‡†å¤‡â†’é¢„å¤„ç†ï¼‰
  - å½©è‰²è¾“å‡ºå’Œè¿›åº¦æç¤º
  - é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º

### 4. æµ‹è¯•å’Œæ–‡æ¡£

#### âœ“ å•å…ƒæµ‹è¯• (`test_data_preparation.py`)
- æ–‡ä»¶åè§£ææµ‹è¯•
- æ•°æ®é›†ç»„ç»‡åŠŸèƒ½æµ‹è¯•
- WAV æ–‡ä»¶éªŒè¯æµ‹è¯•
- ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

#### âœ“ å®Œæ•´æ–‡æ¡£
- `README.md`ï¼šè¯¦ç»†ä½¿ç”¨è¯´æ˜
- `QUICKSTART.md`ï¼šå¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- å†…è”ä»£ç æ–‡æ¡£å’Œæ³¨é‡Š

---

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶æ¸…å•

```
scripts/data_preparation/
â”œâ”€â”€ __init__.py                    # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”œâ”€â”€ prepare_circor.py              # CirCor æ•°æ®é›†å‡†å¤‡ âœ“
â”œâ”€â”€ prepare_physionet2016.py       # PhysioNet 2016 å‡†å¤‡ âœ“
â”œâ”€â”€ prepare_pascal.py              # Pascal æ•°æ®é›†å‡†å¤‡ âœ“
â”œâ”€â”€ prepare_custom.py              # è‡ªå»ºæ•°æ®é›†å‡†å¤‡ âœ“
â”œâ”€â”€ prepare_data.py                # ç»Ÿä¸€å…¥å£è„šæœ¬ âœ“
â”œâ”€â”€ download_datasets.py           # æ•°æ®é›†ä¸‹è½½å·¥å…· âœ“ (æ–°)
â”œâ”€â”€ quickstart.sh                  # å¿«é€Ÿå¯åŠ¨è„šæœ¬ âœ“ (æ–°)
â”œâ”€â”€ test_data_preparation.py       # å•å…ƒæµ‹è¯• âœ“ (æ–°)
â”œâ”€â”€ README.md                      # è¯¦ç»†ä½¿ç”¨è¯´æ˜ âœ“ (æ›´æ–°)
â”œâ”€â”€ QUICKSTART.md                  # å¿«é€Ÿä¸Šæ‰‹æŒ‡å— âœ“ (æ–°)
â””â”€â”€ SUMMARY.md                     # æœ¬æ–‡ä»¶ âœ“ (æ–°)
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èï¼‰

```bash
cd scripts/data_preparation

# å…¬å¼€æ•°æ®é›†
./quickstart.sh full circor           # CirCor å®Œæ•´æµç¨‹
./quickstart.sh full physionet2016    # PhysioNet 2016 å®Œæ•´æµç¨‹

# è‡ªå»ºæ•°æ®é›†
./quickstart.sh prepare custom        # å‡†å¤‡è‡ªå»ºæ•°æ®é›†
./quickstart.sh preprocess custom     # é¢„å¤„ç†
```

### åˆ†æ­¥æ‰§è¡Œ

```bash
# 1. ä¸‹è½½
python download_datasets.py --dataset circor

# 2. å‡†å¤‡
python prepare_circor.py \
    --input-dir ./data/downloads/extracted/... \
    --output-dir ./data/raw/circor

# 3. é¢„å¤„ç†
cd ../..
python scripts/preprocess.py --raw_dir data/raw/circor
```

---

## ğŸ”„ æ•°æ®æµè½¬æµç¨‹

```
åŸå§‹æ•°æ®é›†
    â†“
[ä¸‹è½½/æ‰‹åŠ¨å‡†å¤‡] (download_datasets.py)
    â†“
data/downloads/extracted/
    â†“
[æ•°æ®å‡†å¤‡] (prepare_*.py)
    â†“
data/raw/<dataset>/
â”œâ”€â”€ subject_0001/
â”‚   â”œâ”€â”€ rec_01.wav
â”‚   â””â”€â”€ rec_02.wav
â””â”€â”€ ...
    â†“
[é¢„å¤„ç†] (scripts/preprocess.py)
    â†“
data/processed/
â”œâ”€â”€ subject_0001/
â”‚   â”œâ”€â”€ rec_01/
â”‚   â”‚   â”œâ”€â”€ cycle_000.npy
â”‚   â”‚   â”œâ”€â”€ cycle_001.npy
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â””â”€â”€ statistics.json
    â†“
[é¢„è®­ç»ƒ/å¾®è°ƒ]
```

---

## ğŸ“Š æ”¯æŒçš„æ•°æ®é›†å¯¹æ¯”

| æ•°æ®é›† | ä¸‹è½½æ–¹å¼ | å—è¯•è€…æ•° | ç‰¹ç‚¹ | å‡†å¤‡è„šæœ¬ |
|--------|---------|---------|------|----------|
| **CirCor** | è‡ªåŠ¨ | ~1,000 | å¤šä½ç½®ï¼Œå«è¯Šæ–­ | `prepare_circor.py` |
| **PhysioNet 2016** | è‡ªåŠ¨ | ~3,000 | æ ‡å‡†åˆ†ç±»ä»»åŠ¡ | `prepare_physionet2016.py` |
| **Pascal** | æ‰‹åŠ¨ | ~1,000 | å¤šç–¾ç—…ç±»åˆ« | `prepare_pascal.py` |
| **è‡ªå»º** | æœ¬åœ° | è‡ªå®šä¹‰ | çµæ´»å‘½å | `prepare_custom.py` |

---

## âœ¨ å…³é”®ç‰¹æ€§

### 1. æ— ç¼è¡”æ¥
- æ‰€æœ‰å‡†å¤‡è„šæœ¬è¾“å‡ºæ ¼å¼ç»Ÿä¸€
- ç›´æ¥å¯¹æ¥é¢„å¤„ç†è„šæœ¬ `preprocess.py`
- æ— éœ€æ‰‹åŠ¨è°ƒæ•´æ•°æ®ç»“æ„

### 2. æ™ºèƒ½å¤„ç†
- è‡ªåŠ¨æ£€æµ‹æ•°æ®é›†ç±»å‹
- æ™ºèƒ½æ–‡ä»¶åè§£æ
- è‡ªåŠ¨å…ƒæ•°æ®æå–

### 3. çµæ´»é…ç½®
- ç¬¦å·é“¾æ¥ vs æ–‡ä»¶å¤åˆ¶
- å¯é€‰çš„å…ƒæ•°æ®å¤„ç†
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

### 4. å®¹é”™æœºåˆ¶
- è¾“å…¥éªŒè¯
- é”™è¯¯æ¢å¤
- æ¸…æ™°çš„é”™è¯¯æç¤º

### 5. å®Œæ•´æµ‹è¯•
- å•å…ƒæµ‹è¯•è¦†ç›–
- é›†æˆæµ‹è¯•éªŒè¯
- ç¤ºä¾‹æ•°æ®æµ‹è¯•

---

## ğŸ“– æ–‡æ¡£ç»“æ„

### README.mdï¼ˆè¯¦ç»†æ–‡æ¡£ï¼‰
- å®Œæ•´çš„ä½¿ç”¨è¯´æ˜
- æ¯ä¸ªæ•°æ®é›†çš„è¯¦ç»†æ­¥éª¤
- æ•…éšœæ’æŸ¥æŒ‡å—
- å‚æ•°è¯´æ˜

### QUICKSTART.mdï¼ˆå¿«é€ŸæŒ‡å—ï¼‰
- ä¸€åˆ†é’Ÿå¼€å§‹
- å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
- ç®€æ´çš„æ­¥éª¤è¯´æ˜
- å¿«é€Ÿæ•…éšœæ’æŸ¥

### ä»£ç å†…æ–‡æ¡£
- æ‰€æœ‰å‡½æ•°éƒ½æœ‰ docstring
- å…³é”®æ­¥éª¤æœ‰æ³¨é‡Š
- ä½¿ç”¨ç¤ºä¾‹åœ¨è„šæœ¬å¤´éƒ¨

---

## ğŸ” éªŒè¯æ–¹æ³•

### æ£€æŸ¥å‡†å¤‡ç»“æœ
```bash
# ç›®å½•ç»“æ„
tree -L 2 data/raw/circor

# ç»Ÿè®¡ä¿¡æ¯
ls -1d data/raw/circor/subject_* | wc -l
find data/raw/circor -name "*.wav" | wc -l

# å…ƒæ•°æ®
head data/raw/circor/circor_metadata.csv
```

### è¿è¡Œæµ‹è¯•
```bash
cd scripts/data_preparation
python test_data_preparation.py -v
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ç¬¦å·é“¾æ¥èŠ‚çœç©ºé—´
```bash
python prepare_circor.py --input-dir /path/to/data --output-dir ./data/raw/circor
# ä¸ä½¿ç”¨ --copyï¼Œé»˜è®¤åˆ›å»ºç¬¦å·é“¾æ¥
```

### 2. ä¿ç•™è¯¦ç»†æ—¥å¿—
```bash
python prepare_circor.py ... --verbose 2>&1 | tee preparation.log
```

### 3. æ‰¹é‡å¤„ç†
```bash
# ä¸‹è½½æ‰€æœ‰å…¬å¼€æ•°æ®é›†
python download_datasets.py --dataset all

# é€ä¸ªå‡†å¤‡
for dataset in circor physionet2016 pascal; do
    ./quickstart.sh prepare $dataset
done
```

### 4. è‡ªå»ºæ•°æ®é›†å‘½åè§„èŒƒ
ç¡®ä¿æ–‡ä»¶å‘½åéµå¾ªè§„èŒƒï¼š
```
<condition>_case<id>_<metadata>_<location>.wav
```

---

## ğŸ› ï¸ ä¾èµ–é¡¹

### Python åŒ…
- `pandas`: å…ƒæ•°æ®å¤„ç†
- `numpy`: æ•°å€¼è®¡ç®—
- `scipy`: WAV æ–‡ä»¶è¯»å†™
- `tqdm`: è¿›åº¦æ¡æ˜¾ç¤º
- `requests`: ä¸‹è½½åŠŸèƒ½
- `openpyxl`: Excel æ–‡ä»¶æ”¯æŒï¼ˆå¯é€‰ï¼‰

### å®‰è£…
```bash
pip install pandas numpy scipy tqdm requests openpyxl
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

æ•°æ®å‡†å¤‡å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. **è¿è¡Œé¢„å¤„ç†**
   ```bash
   python scripts/preprocess.py --raw_dir data/raw/circor
   ```

2. **å¼€å§‹é¢„è®­ç»ƒ**
   ```bash
   python scripts/pretrain.py --config configs/pretrain.yaml
   ```

3. **ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒ**
   ```bash
   python scripts/finetune.py --config configs/finetune.yaml
   ```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç£ç›˜ç©ºé—´**ï¼š
   - CirCor: éœ€è¦çº¦ 20 GBï¼ˆåŸå§‹ + å¤„ç†åï¼‰
   - PhysioNet 2016: éœ€è¦çº¦ 3 GB
   - ä½¿ç”¨ç¬¦å·é“¾æ¥å¯èŠ‚çœçº¦ 50% ç©ºé—´

2. **ä¸‹è½½æ—¶é—´**ï¼š
   - CirCor: å–å†³äºç½‘ç»œé€Ÿåº¦ï¼Œçº¦ 10 GB
   - PhysioNet 2016: çº¦ 1.2 GB
   - Pascal: éœ€è¦æ‰‹åŠ¨ä¸‹è½½

3. **å…¼å®¹æ€§**ï¼š
   - Linux/macOS: å®Œå…¨æ”¯æŒç¬¦å·é“¾æ¥
   - Windows: å»ºè®®ä½¿ç”¨ `--copy` å‚æ•°

4. **æ•°æ®éšç§**ï¼š
   - ç¡®ä¿éµå®ˆæ•°æ®é›†ä½¿ç”¨åè®®
   - è‡ªå»ºæ•°æ®é›†æ³¨æ„è„±æ•å¤„ç†

---

## ğŸ”— ç›¸å…³èµ„æº

- **æ•°æ®é›†é“¾æ¥**ï¼š
  - CirCor: https://physionet.org/content/circor-heart-sound/
  - PhysioNet 2016: https://physionet.org/content/challenge-2016/
  - Pascal: https://istethoscope.peterjbentley.com/heartchallenge/

- **é¡¹ç›®æ–‡æ¡£**ï¼š
  - [é¡¹ç›®ä»‹ç»](../../doc/é¡¹ç›®ä»‹ç».md)
  - [é¡¹ç›®ä½¿ç”¨æ–‡æ¡£](../../doc/é¡¹ç›®ä½¿ç”¨æ–‡æ¡£.md)
  - [å®éªŒæ€è·¯](../../doc/å®éªŒæ€è·¯.md)

---

## ğŸ‰ æ€»ç»“

æ‰€æœ‰æ•°æ®å‡†å¤‡è„šæœ¬å·²å®Œæˆå¹¶å¯ä»¥æŠ•å…¥ä½¿ç”¨ï¼š

âœ… **4 ä¸ªå…¬å¼€/è‡ªå»ºæ•°æ®é›†å‡†å¤‡è„šæœ¬**  
âœ… **è‡ªåŠ¨ä¸‹è½½å·¥å…·**  
âœ… **å¿«é€Ÿå¯åŠ¨è„šæœ¬**  
âœ… **å®Œæ•´æµ‹è¯•å¥—ä»¶**  
âœ… **è¯¦ç»†æ–‡æ¡£**  

æ‚¨ç°åœ¨å¯ä»¥ï¼š
- ä½¿ç”¨ `./quickstart.sh full circor` ä¸€é”®å‡†å¤‡ CirCor æ•°æ®é›†
- ä½¿ç”¨ `./quickstart.sh prepare custom` å‡†å¤‡è‡ªå»ºæ•°æ®é›†
- æ‰€æœ‰å‡†å¤‡çš„æ•°æ®éƒ½èƒ½æ— ç¼å¯¹æ¥ `scripts/preprocess.py`

**ç¥æ‚¨å®éªŒé¡ºåˆ©ï¼** ğŸš€
